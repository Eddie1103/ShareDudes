<!DOCTYPE html>
<html lang="en">
<style>
  img {
    display: block;
    max-width: 100%;
    height: auto;
  }
</style>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShareDudes</title>
  <link rel="stylesheet" href="main.css">
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js"
    integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/"
    crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="dynamicscript.js"></script>
</head>

<body>
  <!--Navbar-->
  <nav class="navbar sticky-top navbar-expand-sm navbar-dark bg-primary">
    <a class="navbar-brand mx-2" href="index.html?#">
      <img src="icon/icon.png" width="40" height="40" class="d-inline-block align-center" alt="">
      ShareDudes
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target=".dual-collapse2">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="navbar-collapse collapse w-75 order-0 order-md-0 dual-collapse2">
    </div>
    <div class="navbar-collapse collapse w-100 order-1 dual-collapse2">
      <form class="input-group">
        <input class="form-control" type="search" placeholder="Suchen" aria-label="Suchen">
        <button class="btn btn-secondary" type="submit">Angebot suchen</button>
      </form>
    </div>
    <div class="navbar-collapse collapse w-100 order-3 dual-collapse2">
      <ul class="navbar-nav ms-auto align-center">
        <li class="nav-item">
          <a class="nav-link active align-items-center" aria-current="page" href="login.html?#"
            id="logintext">Anmelden</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active align-items-center" aria-current="page" href="register.html?#"
            id="registertext">Registrieren</a>
        </li>
      </ul>
    </div>
  </nav>

  <!--Create Inserat Button-->
  <div class="text-center p-2">
    <button type="button" data-toggle="modal" data-target=".createModal" class="btn btn-lg btn-secondary"
      id="createButton" onclick="loadOptions()">Eigenes Inserat veröffentlichen</button>
  </div>

  <!--Modal Create Inserat-->
  <div class="modal fade createModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form class="form-signin p-3" onsubmit="postInserat()">
          <h1 class="h3 mb-3 font-weight-normal">Eigenes Inserat</h1>
          <input type="Title" id="inputTitle" class="form-control" placeholder="Inserattitel" required="" autofocus="">
          <h1></h1>
          <select class="form-select" aria-label="Default select example" id="inputAdresses"></select>
          <h1></h1>
          <label for="inputOfferTypes">Inseratart</label>
          <select class="form-select" aria-label="Default select example" id="inputOfferTypes"></select>
          <h1></h1>
          <div class="form-group">
            <label for="DescriptionTextarea">Beschreibung für dein Inserat</label>
            <textarea class="form-control" id="descriptionTextarea" rows="3"></textarea>
          </div>
          <h1></h1>
          <div class="col-md-4 m-5 my-1">
            <div class="mb-4 d-flex ml-auto">
              <img id="selectedImage" src="https://mdbootstrap.com/img/Photos/Others/placeholder.jpg" alt="moiga"
                style="width: 300px;" />
            </div>
            <div class="d-flex">
              <div class="btn btn-primary btn-rounded">
                <label class="form-label text-white m-1" for="customFile1">Bild auswählen</label>
                <input type="file" class="form-control d-none" accept=".png" id="customFile1"
                  onchange="displaySelectedImage(event, 'selectedImage')" />
              </div>
            </div>
          </div>
          <h1></h1>
          <button class="btn btn-lg btn-secondary btn-block w-100" type="submit">Veröffentlichen</button>
        </form>
      </div>
    </div>
  </div>

  <div class="container" id="cardContainer">   <!--Container für Dynamische Karten--> </div>

  <!--Modal zum Angebot anzeigen-->
  <div class="modal fade" id="showModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle">Habe Rouladen übrig!</h5>
          <button type="button" class="btn-close" aria-label="Close" data-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row row-no-margin">
            <div class="col-xs-12 col-sm-6 mx-auto w-100">
              <img loading="lazy"
                src=""
                class="rounded" alt="..." id="modalPic">
            </div>
          </div>
          <div class="p-3 row row-no-margin" id="modalText">
            Habe eine größere Portion gekocht aber der Hunger war größer als der Magen, würde so 3 Stück
            abgegeben!
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal">Schließen</button>
          <button type="button" class="btn btn-secondary">Für Inserat anmelden</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    function isUserLoggedIn(cookieName) {
      var cookies = document.cookie.split(';');
      for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i].trim();

        if (cookie.indexOf(cookieName + "=") === 0) {
          return true;
        }
      }
      return false;
    }

    function removeCookie(cookieName) {
      document.cookie = cookieName + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
      location.reload();
    }

    function postInserat()
    {
      var title = $("#inputTitle").value;
      var offertype = $("#inputOfferTypes").value;
      var descriptionTextarea = $("#descriptionTextarea").value;
      var selectedImage = $("selectedImage").value;
    }

    function updateLoginStatusText() {
      var loginStatusTextElement = document.getElementById('logintext');
      var registerStatusTextElement = document.getElementById('registertext');

      if (isUserLoggedIn("userid")) {
        var imgElement = document.createElement('img');
        imgElement.src = 'https://images.unsplash.com/photo-1561154464-82e9adf32764?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=50&h=50&q=60';
        imgElement.alt = 'Profilbild';
        imgElement.style.cursor = 'pointer';
        imgElement.classList.add('rounded-circle', 'img-fluid')
        loginStatusTextElement.parentNode.replaceChild(imgElement, loginStatusTextElement);

        imgElement.addEventListener('click', function () {
          window.location.href = 'user.html?#';
        });

        var logoutbutton = document.createElement('button');
        logoutbutton.textContent = 'Abmelden';
        logoutbutton.onclick = function () {
          removeCookie("userid");
        };
        logoutbutton.classList.add('btn-secondary', 'btn', 'my-2', 'm-1');

        registerStatusTextElement.parentNode.replaceChild(logoutbutton, registerStatusTextElement);
      }
      else {
        var create = document.getElementById("createButton").style.display = 'none';

      }
    }
    updateLoginStatusText();

    function displaySelectedImage(event, elementId) {
      const selectedImage = document.getElementById(elementId);
      const fileInput = event.target;

      if (fileInput.files && fileInput.files[0]) {
        const reader = new FileReader();

        reader.onload = function (e) {
          selectedImage.src = e.target.result;
        };

        reader.readAsDataURL(fileInput.files[0]);
      }
    }

    function loadOptions() {
      var apiUrl = 'http://194.62.1.218:5000/getoffertypes';

      var selectElement = document.getElementById('inputOfferTypes');
      selectElement.innerHTML = '';
      $.ajax({
        url: apiUrl,
        type: 'GET',
        dataType: 'json',
        success: function (data) {
          $.each(data, function(index, item) 
          {
            var newOption = document.createElement('option');
            newOption.value = item.id;
            newOption.text = item.value;
            selectElement.appendChild(newOption);
          });
      }
      });
    }
  </script>
</body>

</html>